<div class="container mt-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <h1><i class="fas fa-link"></i> Switch Webhooks</h1>
      <p class="text-muted">Registra i tuoi endpoint Switch qui</p>
    </div>
    <div class="col-md-4 text-end">
      <a href="/webhooks/new" class="btn btn-primary"><i class="fas fa-plus"></i> Nuovo Webhook</a>
    </div>
  </div>

  <% if params[:success] %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="fas fa-check"></i> Webhook <%= params[:success] %> con successo!
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% end %>

  <% if @webhooks.any? %>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Nome</th>
            <th>Hook Path</th>
            <th>URL Completo</th>
            <th>Negozio</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          <% @webhooks.each do |webhook| %>
            <tr>
              <td>
                <strong><%= webhook.name %></strong>
              </td>
              <td>
                <code style="font-size: 0.85rem;"><%= webhook.hook_path %></code>
              </td>
              <td>
                <code style="font-size: 0.80rem;"><%= webhook.webhook_url %></code>
              </td>
              <td>
                <% if webhook.store %>
                  <span class="badge bg-info"><%= webhook.store.name %></span>
                <% else %>
                  <span class="badge bg-secondary">Globale</span>
                <% end %>
              </td>
              <td>
                <a href="/webhooks/<%= webhook.id %>/edit" class="btn btn-sm btn-outline-primary">‚úé Modifica</a>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteWebhook(<%= webhook.id %>)"><i class="fas fa-trash"></i> Elimina</button>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <% if @webhooks.any? && @total_pages > 1 %>
        <div class="card-footer bg-white text-center pt-3">
          <nav>
            <ul class="pagination pagination-sm mb-0 justify-content-center">
              <% if @current_page > 1 %>
                <li class="page-item"><a class="page-link" href="/webhooks?page=<%= @current_page - 1 %>">‚Üê Precedente</a></li>
              <% else %>
                <li class="page-item disabled"><span class="page-link">‚Üê Precedente</span></li>
              <% end %>
              <li class="page-item disabled"><span class="page-link"><%= @current_page %> / <%= @total_pages %></span></li>
              <% if @current_page < @total_pages %>
                <li class="page-item"><a class="page-link" href="/webhooks?page=<%= @current_page + 1 %>">Successivo ‚Üí</a></li>
              <% else %>
                <li class="page-item disabled"><span class="page-link">Successivo ‚Üí</span></li>
              <% end %>
            </ul>
          </nav>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info">
      üì≠ Nessun webhook registrato. <a href="/webhooks/new">Crea il primo webhook</a>
    </div>
  <% end %>
</div>

<script>
function deleteWebhook(id) {
  if (confirm('Sei sicuro? Eliminerai questo webhook.')) {
    fetch('/webhooks/' + id, { method: 'DELETE' })
      .then(() => location.href = '/webhooks?success=deleted');
  }
}
</script>
