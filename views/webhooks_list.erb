<div class="container mt-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <h1>ðŸ”— Switch Webhooks</h1>
      <p class="text-muted">Registra i tuoi endpoint Switch qui</p>
    </div>
    <div class="col-md-4 text-end">
      <a href="/webhooks/new" class="btn btn-primary">âž• Nuovo Webhook</a>
    </div>
  </div>

  <% if params[:success] %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      âœ“ Webhook <%= params[:success] %> con successo!
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% end %>

  <% if @webhooks.any? %>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Nome</th>
            <th>Hook Path</th>
            <th>URL Completo</th>
            <th>Negozio</th>
            <th>Stato</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          <% @webhooks.each do |webhook| %>
            <tr>
              <td>
                <strong><%= webhook.name %></strong>
              </td>
              <td>
                <code style="font-size: 0.85rem;"><%= webhook.hook_path %></code>
              </td>
              <td>
                <code style="font-size: 0.80rem;"><%= webhook.webhook_url %></code>
              </td>
              <td>
                <% if webhook.store %>
                  <span class="badge bg-info"><%= webhook.store.name %></span>
                <% else %>
                  <span class="badge bg-secondary">Globale</span>
                <% end %>
              </td>
              <td>
                <% if webhook.active %>
                  <span class="badge bg-success">âœ“ Attivo</span>
                <% else %>
                  <span class="badge bg-danger">âœ— Inattivo</span>
                <% end %>
              </td>
              <td>
                <a href="/webhooks/<%= webhook.id %>/edit" class="btn btn-sm btn-outline-primary">âœŽ Modifica</a>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteWebhook(<%= webhook.id %>)">ðŸ—‘ Elimina</button>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="alert alert-info">
      ðŸ“­ Nessun webhook registrato. <a href="/webhooks/new">Crea il primo webhook</a>
    </div>
  <% end %>
</div>

<script>
function deleteWebhook(id) {
  if (confirm('Sei sicuro? Eliminerai questo webhook.')) {
    fetch('/webhooks/' + id, { method: 'DELETE' })
      .then(() => location.href = '/webhooks?success=deleted');
  }
}
</script>
