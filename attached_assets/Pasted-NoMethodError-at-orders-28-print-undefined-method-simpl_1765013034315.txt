NoMethodError at /orders/28/print
undefined method `simple_format' for #<PrintOrchestrator:0x00007fa57e8e3480 @default_layout=:layout, @preferred_extension="erb", @app=nil, @template_cache=#<Sinatra::TemplateCache:0x00007fa57ca64f18 @cache={[:erb, :print_order_card, {:outvar=>"@_out_buf", :default_encoding=>"utf-8"}, "/home/runner/workspace/views"]=>#<Tilt::ERBTemplate:0x00007fa56f006100 @options={:outvar=>"@_out_buf"}, @line=1, @file="/home/runner/workspace/views/print_order_card.erb", @scope_class=nil, @default_encoding="utf-8", @skip_compiled_encoding_detection=nil, @data="<!DOCTYPE html>\n<html>\n<head>\n <meta charset=\"UTF-8\">\n <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n <title>Scheda Ordine - <%= @order.external_order_code %></title>\n <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n <style>\n body {\n font-family: Arial, sans-serif;\n padding: 20px;\n background: white;\n }\n .header {\n margin-bottom: 30px;\n border-bottom: 3px solid #333;\n padding-bottom: 15px;\n }\n .header h1 {\n margin: 0;\n font-size: 24px;\n font-weight: bold;\n }\n .header-info {\n font-size: 12px;\n color: #666;\n margin-top: 5px;\n }\n .section {\n margin-bottom: 25px;\n }\n .section-title {\n background: #f0f0f0;\n padding: 10px 15px;\n font-weight: bold;\n font-size: 14px;\n margin-bottom: 10px;\n border-left: 4px solid #007bff;\n }\n .info-grid {\n display: grid;\n grid-template-columns: 1fr 1fr;\n gap: 15px;\n margin-bottom: 15px;\n }\n .info-item {\n border: 1px solid #ddd;\n padding: 10px;\n background: #fafafa;\n }\n .info-label {\n font-weight: bold;\n color: #333;\n font-size: 11px;\n }\n .info-value {\n font-size: 12px;\n color: #666;\n margin-top: 3px;\n }\n table {\n width: 100%;\n border-collapse: collapse;\n font-size: 12px;\n }\n table th {\n background: #f9f9f9;\n padding: 8px;\n text-align: left;\n border-bottom: 2px solid #ddd;\n font-weight: bold;\n }\n table td {\n padding: 8px;\n border-bottom: 1px solid #ddd;\n }\n table tr:nth-child(even) {\n background: #fafafa;\n }\n .status-badge {\n display: inline-block;\n padding: 4px 8px;\n border-radius: 3px;\n font-size: 11px;\n font-weight: bold;\n background: #e3f2fd;\n color: #1976d2;\n }\n @media print {\n body {\n padding: 0;\n }\n }\n </style>\n</head>\n<body>\n <div class=\"header\">\n <h1><i class=\"fas fa-receipt\"></i> Scheda Ordine</h1>\n <div class=\"header-info\">\n <strong>Codice Ordine:</strong> <%= @order.external_order_code %> | \n <strong>Data:</strong> <%= @order.created_at.strftime('%d/%m/%Y %H:%M') %> |\n <strong>Negozio:</strong> <%= @order.store.code %>\n </div>\n </div>\n\n <div class=\"section\">\n <div class=\"section-title\">Informazioni Ordine</div>\n <div class=\"info-grid\">\n <div class=\"info-item\">\n <div class=\"info-label\">ID Ordine</div>\n <div class=\"info-value\">#<%= @order.id %></div>\n </div>\n <div class=\"info-item\">\n <div class=\"info-label\">Codice Ordine</div>\n <div class=\"info-value\"><strong><%= @order.external_order_code %></strong></div>\n </div>\n <div class=\"info-item\">\n <div class=\"info-label\">Negozio</div>\n <div class=\"info-value\"><%= @order.store.name %> (<%= @order.store.code %>)</div>\n </div>\n <div class=\"info-item\">\n <div class=\"info-label\">Stato</div>\n <div class=\"info-value\">\n <span class=\"status-badge\"><%= @order.status.gsub('_', ' ').upcase %></span>\n </div>\n </div>\n <div class=\"info-item\">\n <div class=\"info-label\">Data Creazione</div>\n <div class=\"info-value\"><%= @order.created_at.strftime('%d/%m/%Y') %></div>\n </div>\n <div class=\"info-item\">\n <div class=\"info-label\">Total Line Items</div>\n <div class=\"info-value\"><%= @order.order_items.count %></div>\n </div>\n </div>\n </div>\n\n <% if @order.customer_note.present? %>\n <div class=\"section\">\n <div class=\"section-title\">Note Ordine</div>\n <div style=\"background: #fff9e6; border: 1px solid #ffd700; padding: 12px; border-radius: 4px; line-height: 1.5;\">\n <%= simple_format(@order.customer_note) %>\n </div>\n </div>\n <% end %>\n\n <div class=\"section\">\n <div class=\"section-title\">Line Items Ordine</div>\n <table>\n <thead>\n <tr>\n <th>#</th>\n <th>Prodotto</th>\n <th>Quantità</th>\n <th>Pre-Stampa</th>\n <th>Stampa</th>\n </tr>\n </thead>\n <tbody>\n <% @order.order_items.each_with_index do |item, index| %>\n <tr>\n <td><strong><%= index + 1 %></strong></td>\n <td><%= item.product&.name || item.sku %></td>\n <td><%= item.quantity %></td>\n <td>\n <% if item.preprint_status == 'completed' %>\n <span style=\"color: green; font-weight: bold;\">✓ Completato</span>\n <% elsif item.preprint_status == 'processing' %>\n <span style=\"color: orange; font-weight: bold;\">⧗ In corso</span>\n <% elsif item.preprint_status == 'failed' %>\n <span style=\"color: red; font-weight: bold;\">✗ Errore</span>\n <% else %>\n <span style=\"color: #999;\">-</span>\n <% end %>\n </td>\n <td>\n <% if item.print_status == 'completed' %>\n <span style=\"color: green; font-weight: bold;\">✓ Completato</span>\n <% elsif item.print_status == 'processing' %>\n <span style=\"color: orange; font-weight: bold;\">⧗ In corso</span>\n <% elsif item.print_status == 'failed' %>\n <span style=\"color: red; font-weight: bold;\">✗ Errore</span>\n <% else %>\n <span style=\"color: #999;\">-</span>\n <% end %>\n </td>\n </tr>\n <% end %>\n </tbody>\n </table>\n </div>\n\n <div class=\"section\" style=\"margin-top: 40px; padding-top: 20px; border-top: 2px solid #ddd; font-size: 11px; color: #999;\">\n <p>Documento generato automaticamen