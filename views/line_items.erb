
<div style="margin-bottom: 15px;">
  <form method="get" action="/line_items" style="display: flex; gap: 10px; align-items: center;">
    <select class="form-select form-select-sm" name="status_filter" onchange="this.form.submit()" style="width: auto;">
      <option value="">Tutti gli stati</option>
      <option value="nuovo" <%= 'selected' if @filter_status == 'nuovo' %>>Nuovo</option>
      <option value="pre-stampa" <%= 'selected' if @filter_status == 'pre-stampa' %>>Pre-stampa (in corso)</option>
      <option value="stampa" <%= 'selected' if @filter_status == 'stampa' %>>Attende Stampa</option>
    </select>
    <a href="/line_items" class="btn btn-outline-secondary btn-sm"><i class="fas fa-redo"></i> Reset</a>
  </form>
</div>

<% if @line_items.empty? %>
  <div class="alert alert-info">
    <% if @search_term.present? %>
      Nessun article trovato con il nome "<%= @search_term %>"
    <% else %>
      Nessun article in lavorazione
    <% end %>
  </div>
<% else %>
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Data Ordine</th>
          <th>Codice Ordine</th>
          <th>Negozio</th>
          <th>Nome Prodotto</th>
          <th>SKU</th>
          <th>Quantit√†</th>
          <th>Stato Ordine</th>
          <th>Azioni</th>
        </tr>
        <tr style="background-color: var(--neutral-100);">
          <td>
            <form method="get" action="/line_items" style="display: contents;">
              <input type="date" class="form-control form-control-sm" name="order_date" value="<%= @filter_order_date %>">
          </td>
          <td>
              <input type="text" class="form-control form-control-sm" name="order_code" placeholder="Numero..." value="<%= @filter_order_code %>">
          </td>
          <td>
              <select class="form-select form-select-sm" name="store_id" onchange="this.form.submit()">
                <option value="">Tutti negozi</option>
                <% @stores.each do |store| %>
                  <option value="<%= store.id %>" <%= 'selected' if @filter_store == store.id.to_s %>>
                    <%= store.name %>
                  </option>
                <% end %>
              </select>
          </td>
          <td>
              <input type="text" class="form-control form-control-sm" name="product_name" placeholder="Nome..." value="<%= @filter_product_name %>">
          </td>
          <td>
              <input type="text" class="form-control form-control-sm" name="sku" placeholder="SKU..." value="<%= @filter_sku %>">
          </td>
          <td></td>
          <td></td>
          <td style="display: flex; gap: 4px; justify-content: flex-end;">
              <button type="submit" class="btn btn-primary btn-sm" style="padding: 0.375rem 0.75rem;"><i class="fas fa-filter"></i> Filtra</button>
              <a href="/line_items" class="btn btn-outline-secondary btn-sm" style="padding: 0.375rem 0.75rem;"><i class="fas fa-redo"></i> Reset</a>
            </form>
          </td>
        </tr>
      </thead>
      <tbody>
        <% @line_items.each do |li| %>
          <tr>
            <td><%= li[:order].created_at.strftime('%d-%m-%y') %></td>
            <td><a href="/orders/<%= li[:order].id %>"><%= li[:order].external_order_code %></a></td>
            <td><%= li[:order].store.name %></td>
            <td><strong><%= li[:product_name] %></strong></td>
            <td><code><%= li[:item].sku %></code></td>
            <td><%= li[:item].quantity %></td>
            <td>
              <% workflow_status = li[:item].workflow_status %>
              <% status_color = case workflow_status
                when 'nuovo'
                  'bg-info'
                when 'pre-stampa'
                  'bg-warning text-dark'
                when 'stampa'
                  'bg-primary'
                when 'completato'
                  'bg-success'
                else
                  'bg-secondary'
                end %>
              <span class="badge <%= status_color %>">
                <%= workflow_status.upcase %>
              </span>
            </td>
            <td>
              <div style="display: flex; gap: 4px;">
                <a href="/orders/<%= li[:order].id %>/items/<%= li[:item].id %>" class="btn btn-sm btn-outline-secondary" style="padding: 2px 6px; font-size: 14px;" title="Visualizza job"><i class="fas fa-eye"></i></a>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  
  <div class="alert alert-info mt-4">
    <strong>Totale:</strong> <%= @line_items.count %> article da elaborare
  </div>
<% end %>
